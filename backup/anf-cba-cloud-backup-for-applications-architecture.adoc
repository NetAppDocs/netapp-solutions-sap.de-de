---
sidebar: sidebar 
permalink: backup/anf-cba-cloud-backup-for-applications-architecture.html 
keywords: applications, anf, strategy, data protection, backup 
summary: Cloud Backup für Applikationen ist eine SaaS-Lösung mit Datensicherungsfunktionen für Applikationen, die auf NetApp Cloud-Storage ausgeführt werden. Cloud Backup für Applikationen, die in NetApp BlueXP möglich sind, bietet effizienten, applikationskonsistenten und richtlinienbasierten Schutz von SAP HANA auf Azure NetApp Files. Cloud Backup für Applikationen bietet zentrale Kontrolle und Überwachung und delegiert gleichzeitig die Fähigkeit von Benutzern, applikationsspezifische Backup- und Restore-Vorgänge zu managen. 
---
= Architektur von Cloud Backup für Applikationen
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-use-cases-and-value-of-accelerated-backup-and-cloning-operations_overview.html["Früher: Architekturübersicht über Cloud Backup für Applikationen"]

[role="lead"]
Cloud Backup für Applikationen ist eine SaaS-Lösung mit Datensicherungsfunktionen für Applikationen, die auf NetApp Cloud-Storage ausgeführt werden. Cloud Backup für Applikationen, die in NetApp BlueXP möglich sind, bietet effizienten, applikationskonsistenten und richtlinienbasierten Schutz von SAP HANA auf Azure NetApp Files. Cloud Backup für Applikationen bietet zentrale Kontrolle und Überwachung und delegiert gleichzeitig die Fähigkeit von Benutzern, applikationsspezifische Backup- und Restore-Vorgänge zu managen.

Cloud Backup für Applikationen wird in NetApp BlueXP als SaaS ausgeführt und nutzt das Framework und die UI. Das BlueXP Arbeitsumgebungs-Framework wird verwendet, um die Zugangsdaten für Azure NetApp Files zu konfigurieren und zu managen.

Ein BlueXP Connector muss innerhalb des vnet des Kunden implementiert werden. Die Kommunikation zwischen den NetApp SaaS Komponenten und der Kundenumgebung wird ausschließlich über den Connector durchgeführt. Der Connector führt die ANF-Storage-Vorgänge mithilfe der ANF-Management-APIs aus.

Das HANA-Plug-in bietet die für die HANA-Datenbank spezifische Logik und muss auf jedem HANA-Host implementiert werden. Das HANA-Plug-in kommuniziert mit der HANA-Datenbank über den HANA-hdbsql-Client und einen User Store-Schlüssel. Alle Datenbankvorgänge werden vom BlueXP Connector ausgelöst.

image:anf-cba-image5.png["Dieses Bild zeigt die Basisarchitektur von NetApp SaaS in Kombination mit dem Kundennetzwerk und einem Azure Abonnement."]



== Cloud Backup für Applikationen für SAP HANA auf ANF



=== Lösungsüberblick

Cloud Backup für die Applikation unterstützt Snapshot-basierte Backup-Vorgänge für die folgenden Komponenten:

. *SAP HANA System* Datenvolumen.
. *Nicht-Datenvolumen* einer SAP HANA-Datenbank. Beispiel: Der `/hana/shared` Volume- und/oder SAP Applikations-Server-Daten übertragen.
. *Global non-Data Volume(s)*, die nicht zu einem bestimmten HANA-System gehören. Zum Beispiel das SAP-Transportverzeichnis `/usr/sap/trans`.


Die Backup-Vorgänge dieser Komponenten umfassen Folgendes:

* Geplante oder On-Demand-Backups
* Optionale Pre- und Post-Skripte
* Richtlinienbasiertes Aufbewahrungsmanagement
+
** Für Snapshots auf ANF-Volume-Ebene
** Innerhalb des SAP HANA-Backup-Katalogs (für HANA-Daten-Volume-Backups)




Dateibasierte SAP HANA Backups werden für Integritätsprüfungen der Datenbankblöcke verwendet und können entweder On-Demand oder als geplanter Backup-Vorgänge ausgeführt werden. Das richtlinienbasierte Aufbewahrungsmanagement wird auf Filesystem-Ebene und im HANA-Backup-Katalog durchgeführt.

Das Aufbewahrungsmanagement von HANA-Datenbank-Log-Backups wird auf Basis der definierten Aufbewahrung von HANA-Datenbank-Daten-Backups (Snapshot- oder dateibasiert) durchgeführt.

CBA unterstützt Wiederherstellungsvorgänge für alle Snapshot-basierten Backups. Dateibasierte Backups können nur mit nativen HANA Tools wiederhergestellt werden.

image:anf-cba-image6.png["Dieses Bild zeigt Backup und Restore für einen mandantenfähigen Datenbank-Container des HANA-Systems und globale nicht-Daten-Volumes."]



=== Lösungsbetrieb

Backups der Snapshot Daten werden mit Cloud Backup für Applikationen ausgeführt. Dazu wird der Savepoint für das Backup der SAP HANA Datenbank getriggert, sodass die Snapshot Kopie, die auf der Storage-Ebene erstellt wird, auf einem konsistenten Image der SAP HANA Datenbank basiert. Siehe https://help.sap.com/docs/SAP_HANA_PLATFORM/6b94445c94ae495c83a19646e7c3fd56/b41a2823576f4726be649bc98e61d62c.html?q=sap%20hana%20snapshot%20backup["SAP-Administrationshandbuch"^] Finden Sie weitere Informationen.

Um ein vollständiges Backup aller im Zusammenhang mit SAP HANA stehenden Ressourcen zu ermöglichen, ermöglicht Cloud Backup for Applications außerdem das Backup aller nicht datenbezogenen Volumes mit Storage-basierten Snapshot Kopien. Sie können nicht-Daten-Volumes unabhängig vom Datenbank-Daten-Backup planen, um individuelle Aufbewahrungs- und Sicherungsrichtlinien zu aktivieren.

SAP empfiehlt, Storage-basierte Snapshot-Backups mit einem wöchentlichen dateibasierten Backup zu kombinieren, um eine Integritätsprüfung für Blöcke durchzuführen. Sie können die Blockintegritätsprüfung innerhalb von CBA ausführen. Block-Integritätsprüfung (dateibasierte) Backups werden auch verwendet, um Backups in einen zweiten Storage-Standort zu verlagern.

Cloud Backup für Applikationen basiert auf Ihren konfigurierbaren Aufbewahrungsrichtlinien und managt die Organisation von Daten-Backups, Protokollierung von Backups und den SAP HANA Backup-Katalog.

Die folgende Abbildung fasst die Backup-Lösung zusammen.

image:anf-cba-image7.png["Diese Abbildung fasst die Backup-Lösung zusammen."]

Beim Ausführen eines Storage-basierten Snapshot-Backups von nicht-Daten-Volumes führt Cloud Backup für Applikationen die folgenden Aufgaben aus:

. Erstellt eine Storage-Snapshot-Kopie des nicht-Daten-Volumes
. Löscht Storage-Snapshot-Kopien auf der Grundlage der definierten Aufbewahrungsrichtlinie.


Bei der Ausführung eines Storage-basierten Snapshot-Backups der SAP HANA-Datenbank führt Cloud Backup for Applications die folgenden Aufgaben aus:

. Erstellung eines SAP HANA-Backup-Speicherpunktes, um ein konsistentes Image auf der Persistenzschicht zu erstellen.
. Erstellt eine Storage-Snapshot-Kopie des/der Daten-Volumes.
. Registriert das Storage Snapshot-Backup im SAP HANA Backup-Katalog.
. Gibt den Speicherpunkt für SAP HANA-Backup frei.
. Löscht Storage-Snapshot-Kopien auf der Grundlage der definierten Aufbewahrungsrichtlinie.
. Löscht die Einträge des SAP HANA-Backup-Katalogs basierend auf der festgelegten Aufbewahrungsrichtlinie.
. Immer wenn ein Daten-Backup manuell oder basierend auf der Aufbewahrungsrichtlinie gelöscht wurde, löscht Cloud Backup für Applikationen alle Log-Backups, die älter als das älteste Daten-Backup sind. Log-Backups werden im Dateisystem und im SAP HANA Backup-Katalog gelöscht.




=== Unterstützte SAP HANA-Versionen und -Konfigurationen

Cloud Backup für Applikationen unterstützt HANA MDC-Systeme mit einer einzelnen oder mehreren Mandanten und folgenden Konfigurationsoptionen:

* SAP HANA 2.0 SPS4 und höher
* Systeme mit einem einzelnen Host für SAP HANA
* SAP HANA Systeme mit mehreren Hosts, wie im Abschnitt beschrieben link:anf-cba-backup-operations-with-hana-system-replication.html#backup-operations-with-hana-multiple-host-systems["„Backup Operations with HANA Multiple-Host Systems“"]
* Das SAP HANA-System ist wie im Abschnitt beschrieben mit HANA System Replication (HSR) konfiguriert link:anf-cba-backup-operations-with-hana-system-replication.html["„Backup-Vorgänge mit HANA System Replication“"]




== Konzepte und Best Practices für Cloud Backup für Applikationen



=== Datensicherung Strategie

Bevor Sie Cloud Backup für Applikationen konfigurieren, müssen Sie die Datensicherungsstrategie auf Basis der RTO- und RPO-Anforderungen der verschiedenen SAP-Systeme definieren.

Es üblich, Systemtypen zu definieren, wie z. B. Systeme für Produktion, Entwicklung, Tests oder Sandboxing. Alle SAP-Systeme des gleichen Systemtyps haben typischerweise die gleichen Datenschutzparameter.

Sie müssen die folgenden Parameter definieren:

* Wie oft ein Snapshot Backup ausgeführt wird
* Wie lange ein Snapshot Backup aufbewahrt wird
* Wie oft wird eine Block-Integritätsprüfung (dateibasierte Backups) ausgeführt
* Wie lange ein Backup zur Blockintegritätsprüfung (dateibasiertes Backup) aufbewahrt wird


Die folgende Tabelle zeigt ein Beispiel für Datenschutzparameter für die Systemtypen Produktion, Entwicklung und Test. Für das Produktionssystem wurde eine hohe Backup-Häufigkeit definiert und wöchentliche dateibasierte Backups durchgeführt. Die Test- und Entwicklungssysteme müssen niedriger sein und Snapshot Backups werden seltener durchgeführt.

|===
| Parameter | Produktionssysteme auszuführen | Entwicklungssysteme | Testsysteme 


| Häufigkeit von Snapshot-Backups | Alle 4 Stunden | Alle 6 Stunden | Alle 12 Stunden 


| Snapshot Backup-Aufbewahrung | 3 Tage | 3 Tage | 3 Tage 


| Block-Integritätsprüfung | Einmal in der Woche | Einmal in der Woche | Einmal in der Woche 


| Aufbewahrung der Block-Integritätsprüfung | 4 Wochen | 2 Wochen | 1 Woche 
|===
In der folgenden Tabelle werden die Richtlinien aufgeführt, die für die Datensicherheitsparameter für Snapshot-Backup-Vorgänge konfiguriert werden müssen.

|===
| Parameter | Policy SnapshotAlly4h | Policy SnapshotAlly6h | Policy SnapshotEvery12h 


| Backup-Typ | Auf Snapshot-Basis | Auf Snapshot-Basis | Auf Snapshot-Basis 


| Zeitplantyp | Stündlich | Stündlich | Stündlich 


| Aufbewahrung | Anzahl = 18 | Anzahl = 12 | Anzahl = 3 


| Backup-Zeitplan | Alle 4 Stunden | Alle 6 Stunden | Alle 12 Stunden 
|===
In der folgenden Tabelle werden die Richtlinien aufgeführt, die für die Datensicherungsparameter für dateibasierte Backup-Vorgänge konfiguriert werden müssen.

|===
| Parameter | Policy FileBased4Week | Policy FileBased2Weeks | Policy FileBased1Week 


| Backup-Typ | File-basiert | File-basiert | File-basiert 


| Zeitplantyp | Wöchentlich | Wöchentlich | Wöchentlich 


| Aufbewahrung | Anzahl = 4 | Anzahl = 2 | Anzahl = 1 


| Backup-Zeitplan | Jeden Sonntag | Jeden Sonntag | Jeden Sonntag 
|===


== Backup-Vorgänge

SAP hat mit HANA 2.0 SPS4 die Unterstützung für Snapshot Backups in MDC Mehrmandantensystemen eingeführt. In einem SAP HANA MDC-System ist die Mandantenkonfiguration nicht unbedingt statisch. Mandanten können hinzugefügt oder gelöscht werden. Cloud Backup für Applikationen kann nicht von der Konfiguration abhängen, die beim Hinzufügen der HANA-Datenbank zu Cloud Backup für Applikationen erkannt wird. Cloud Backup für Applikationen muss wissen, welche Mandanten zum Zeitpunkt der Ausführung des Backup-Vorgangs verfügbar sind.

Somit müssen bei jedem Backup-Vorgang die Mandantendaten angezeigt werden. Der nächste Schritt ist der Snapshot-Backup-Vorgang selbst. Dieser Schritt beinhaltet den SQL-Befehl zum Auslösen des HANA Backup Savepoint, das ANF Snapshot Backup und den SQL-Befehl zum Schließen des HANA Backup Savepoint. Mit dem Befehl close aktualisiert die HANA-Datenbank den Backup-Katalog der Systemdatenbank und jeden Mandanten.


NOTE: SAP HANA unterstützt keine Snapshot-Backup-Vorgänge für MDC-Systeme, wenn ein oder mehrere Mandanten angehalten werden.

Für das Aufbewahrungsmanagement von Daten-Backups und HANA-Backup-Katalogmanagement muss Cloud Backup für Applikationen die Kataloglöschung für die Systemdatenbank und alle Mandantendatenbanken ausführen, die im ersten Schritt identifiziert wurden. Ebenso muss der Workflow von Cloud Backup für Applikationen bei den Log-Backups auf allen Mandanten ausgeführt werden, die Teil des Backup-Vorgangs waren.

Die folgende Abbildung zeigt einen Überblick über den Backup-Workflow.

image:anf-cba-image8.png["Diese Abbildung zeigt einen Überblick über den Backup-Workflow."]



=== Backup-Workflow für Snapshot-Backups der HANA-Datenbank

Cloud Backup für Applikationen sichert die SAP HANA Datenbank in der folgenden Reihenfolge:

. Cloud Backup für Applikationen liest die Liste der Mandanten aus der HANA-Datenbank.
. Mandanteninformationen werden im Metadaten von Cloud Backup for Applications für den Backup-Vorgang gespeichert.
. Cloud Backup für Applikationen löst einen globalen synchronisierten SAP HANA Backup-Speicherpunkt aus, um auf der Persistenzschicht ein konsistentes Datenbank-Image zu erstellen.
+

NOTE: Für ein SAP HANA MDC-System mit einem oder mehreren Mandanten wird ein synchronisierter globaler Backup-Savepoint für die Systemdatenbank und für jede Mandantendatenbank mit nur einem Vorgang erstellt.

. Cloud Backup für Applikationen erstellt ANF Snapshot Kopien für alle für das HANA-System konfigurierten Daten-Volumes. Für eine HANA-Datenbank mit einem Host gibt es nur ein Daten-Volume. Bei einer SAP HANA Datenbank mit mehreren Hosts sind mehrere Daten-Volumes vorhanden.
. Cloud Backup für Applikationen registriert das Snapshot-Backup im SAP HANA Backup-Katalog.
. Cloud Backup für Applikationen löscht den SAP HANA Backup-Savepoint.
. Cloud Backup für Applikationen löscht die ANF Snapshot-Kopien und die Backup-Einträge in seiner Datenbank und im SAP HANA Backup-Katalog basierend auf der für Backups definierten Aufbewahrungsrichtlinie. HANA Backup-Katalogvorgänge werden für die Systemdatenbank und alle Mandanten durchgeführt.
. Cloud Backup for Applications löscht alle Protokollsicherungen auf dem Dateisystem und im SAP HANA-Backup-Katalog, die älter sind als die älteste erfolgreiche Datensicherung, die im SAP HANA-Backup-Katalog identifiziert wurde. Diese Vorgänge werden für die Systemdatenbank und alle Mandanten durchgeführt.




=== Backup-Workflow für die Überprüfung der Blockintegrität

Cloud Backup für Applikationen führt die Block-Integritätsprüfung in folgender Reihenfolge durch:

. Cloud Backup für Applikationen liest die Liste der Mandanten aus der HANA-Datenbank.
. Cloud Backup für Applikationen löst einen dateibasierten Backup-Vorgang für die Systemdatenbank und alle Mandanten aus.
. Cloud Backup for Applications löscht dateibasierte Backups in seiner Datenbank, auf dem Dateisystem und im SAP HANA-Backup-Katalog basierend auf der Aufbewahrungsrichtlinie, die für Blockintegritätsprüfungsvorgänge definiert ist. Backup-Löschung auf dem Filesystem und HANA Backup-Katalogvorgänge werden für die Systemdatenbank und alle Mandanten durchgeführt.
. Cloud Backup for Applications löscht alle Protokollsicherungen auf dem Dateisystem und im SAP HANA-Backup-Katalog, die älter sind als die älteste im SAP HANA-Backup-Katalog identifizierte Datensicherung. Diese Vorgänge werden für die Systemdatenbank und alle Mandanten durchgeführt.




== Management der Backup-Aufbewahrung und allgemeine Ordnung der Daten und Backup-Protokollierung

Das Management der Aufbewahrung von Daten-Backups und die allgemeine Ordnung und Sauberkeit des Backup-Protokolls lassen sich in vier Hauptbereiche unterteilen, darunter das Aufbewahrungsmanagement für die folgenden Bereiche:

* Snapshot Backups
* Dateibasierten Backups
* Daten-Backups im SAP HANA Backup-Katalog
* Protokollierung von Backups im SAP HANA Backup-Katalog und im Filesystem


Die folgende Abbildung bietet einen Überblick über die verschiedenen Workflows und die Abhängigkeiten jedes einzelnen Vorgangs. In den folgenden Abschnitten werden die verschiedenen Operationen im Detail beschrieben.

image:anf-cba-image9.png["Diese Abbildung bietet einen Überblick über die verschiedenen Workflows und die Abhängigkeiten der einzelnen Vorgänge."]



=== Aufbewahrungsmanagement von Snapshot-Backups

Cloud Backup für Applikationen führt die allgemeine Ordnung und Sauberkeit von SAP HANA Datenbank-Backups und nicht-Daten-Volume-Backups durch, indem Snapshot Kopien auf dem Storage und im Cloud Backup für Applikationen Repository gemäß der in der Backup-Richtlinie Cloud Backup für Applikationen definierten Aufbewahrung gelöscht werden.

Die Logik des Aufbewahrungsmanagements wird mit jedem Backup-Workflow in Cloud Backup für Applikationen ausgeführt.

Sie können Snapshot-Backups auch in Cloud Backup for Applications manuell löschen.



=== Aufbewahrungsmanagement von dateibasierten Backups

Cloud Backup für Applikationen übernimmt die Organisation dateibasierter Backups, indem die Backups gemäß der in der Backup-Richtlinie Cloud-Backup für Applikationen definierten Aufbewahrung auf dem File-System gelöscht werden.

Die Logik des Aufbewahrungsmanagements wird mit jedem Backup-Workflow in Cloud Backup für Applikationen ausgeführt.



=== Aufbewahrungsmanagement von Daten-Backups im SAP HANA Backup-Katalog

Wenn Cloud Backup for Applications ein Backup (Snapshot- oder dateibasiert) löscht, wird dieses Daten-Backup auch im SAP HANA Backup-Katalog gelöscht.



=== Aufbewahrungsmanagement von Protokoll-Backups

Die SAP HANA Datenbank erstellt automatisch Protokoll-Backups. Diese Log-Backup-Läufe erstellen Backup-Dateien für jeden einzelnen SAP HANA-Dienst in einem Backup-Verzeichnis, das in SAP HANA konfiguriert ist.

Protokollsicherungen, die älter als die älteste erfolgreiche Datensicherung sind, werden nicht mehr für die Vorwärtswiederherstellung benötigt und können daher gelöscht werden.

Cloud Backup für Applikationen übernimmt die allgemeine Ordnung und Sauberkeit von Log-Datei-Backups auf File-System-Ebene sowie im SAP HANA-Backup-Katalog, indem Sie die folgenden Schritte durchführen:

* Cloud Backup für Applikationen liest den SAP HANA Backup-Katalog, um die Backup-ID des ältesten erfolgreichen dateibasierten oder Snapshot Backups zu erhalten.
* Cloud Backup for Applications löscht alle Protokollsicherungen im SAP HANA-Katalog und im Dateisystem, die älter als diese Backup-ID sind.



NOTE: Cloud Backup für Applikationen führt nur die Organisation von Backups durch, die mit Cloud Backup für Applikationen erstellt wurden. Falls zusätzliche Daten-Backups außerhalb von Cloud Backup for Applications erstellt werden, müssen Sie sicherstellen, dass die Daten-Backups aus dem Backup-Katalog gelöscht werden. Wenn eine solche Datensicherung nicht manuell aus dem Backup-Katalog gelöscht wird, kann sie zur ältesten Datensicherung werden, und ältere Protokollsicherungen werden erst gelöscht, wenn diese Datensicherung gelöscht wird.


NOTE: Die Organisation von Protokollbackups ist standardmäßig aktiviert, kann jedoch auf der Host-Ebene des HANA-Plug-in deaktiviert werden. Bearbeiten Sie das `hana.property` Datei `/opt/NetApp/snapcenter/scc/etc`. Einschließlich des Parameters `LOG_CLEANUP_DISABLE = Y` Im `hana.property` Die Konfigurationsdatei deaktiviert die Wartung der Protokollsicherung. Wenn die Datei nicht vorhanden ist, müssen Sie sie erstellen.



== Ermöglichen Sie eine sichere Kommunikation mit der HANA-Datenbank

Wenn die HANA-Datenbank mit sicherer Kommunikation konfiguriert ist, wird der `hdbsql` Befehl, der von CBA ausgeführt wird, muss zusätzliche Befehlszeilenoptionen verwenden. Dies kann durch die Verwendung eines Wrapper-Skripts erreicht werden, das aufruft `hdbsql` Mit den erforderlichen Optionen.


NOTE: Es gibt verschiedene Optionen zum Konfigurieren der SSL-Kommunikation. In den folgenden Beispielen wird die einfachste Client-Konfiguration mit der Befehlszeilenoption beschrieben, bei der keine Server-Zertifikatvalidierung durchgeführt wird. Wenn eine Zertifikatvalidierung auf der Server- und/oder Client-Seite erforderlich ist, sind verschiedene hdbsql-Befehlszeilenoptionen erforderlich, und Sie müssen die PSE-Umgebung entsprechend konfigurieren, wie im SAP HANA Security Guide beschrieben.

Anstatt die zu konfigurieren `hdbsql` Ausführbar in `hana.properties` Dateien, fügen Sie das Wrapper-Skript hinzu. In der Datei `/opt/NetApp/snapcenter/scc/etc/hana.properties`, Müssen Sie den folgenden Inhalt hinzufügen. Wenn die Datei nicht vorhanden ist, müssen Sie sie erstellen.

Dieses Beispiel ist für ein HANA-System mit SID=SM1 und Instanznummer=12.

....
HANA_HDBSQL_CMD = /usr/sap/SM1/HDB12/exe/hdbsqls
....
Das Wrapper-Skript `hdbsqls` Anrufe `hdbsql` Mit den erforderlichen Befehlszeilenoptionen.

....
#/bin/bash
/usr/sap/SM1/HDB12/exe/hdbsql -e -ssltrustcert $*
....


== Kapazitätsanforderungen für Snapshot Backups

Dabei müssen Sie die höhere Blockänderungsrate auf Storage-Ebene in Relation zur Änderungsrate bei herkömmlichen Datenbanken berücksichtigen. Aufgrund des HANA-Tabellenzusammenführungsprozesses des Spaltenspeichers wird die komplette Tabelle auf die Festplatte geschrieben, nicht nur die geänderten Daten in der Tabelle.

Aus den Daten unseres Kundenstamms geht eine tägliche Änderungsrate zwischen 20% und 50% pro Tag hervor, wenn mehrere Snapshot-Backups während des Tages erstellt werden.

link:anf-cba-overview-of-installation-and-configuration-steps.html["Weiter: Überblick über die Installations- und Konfigurationsschritte."]
