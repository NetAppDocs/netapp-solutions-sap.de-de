---
sidebar: sidebar 
permalink: backup/anf-cba-backup-operations-with-hana-system-replication.html 
keywords: system replication, cba, hsr, multiple host, standby host 
summary: In diesem Abschnitt wird die Durchführung von Backup-Vorgängen mit HANA-Systemreplikation beschrieben. 
---
= Backup-Vorgänge mit HANA System Replication
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-restore-and-recovery-from-snapshot-backup.html["Zurück: Wiederherstellung und Recovery aus Snapshot-Backup."]



== Storage Snapshot Backups und HANA System Replication

Backup-Vorgänge werden immer auf dem primären SAP HANA-Host ausgeführt, da die für den Backup-Vorgang erforderlichen SQL-Befehle nicht auf dem sekundären SAP HANA-Host ausgeführt werden können.

Für SAP HANA-Backup-Vorgänge sind die primären und sekundären SAP HANA-Hosts eine Einheit. Sie verwenden denselben SAP HANA Backup-Katalog und Backups für die Wiederherstellung und Recovery, unabhängig davon, ob das Backup auf dem primären oder sekundären SAP HANA Host erstellt wurde.

Da jedes Backup für die Wiederherstellung verwendet und mithilfe von Log-Backups von beiden Hosts durchgeführt werden kann, ist ein gemeinsamer Backup-Ort für Protokolle erforderlich, auf den von beiden Hosts zugegriffen werden kann. NetApp empfiehlt die Verwendung eines Shared Storage Volume. Sie sollten jedoch auch das Ziel der Protokollsicherung in Unterverzeichnisse innerhalb des gemeinsam genutzten Volumes trennen.

Jeder SAP HANA-Host verfügt über ein eigenes Storage-Volume. Wenn Sie für ein Backup einen Storage-basierten Snapshot verwenden, wird auf dem Storage-Volume des primären SAP HANA Hosts eine datenbankkonsistente Snapshot-Kopie erstellt.

image:anf-cba-image102.png["Diese Abbildung zeigt, wie eine datenbankkonsistente Snapshot-Kopie auf dem Storage-Volume des primären SAP HANA-Hosts erstellt wird."]

Wenn ein Failover auf Host 2 durchgeführt wird, wird Host 2 zum primären SAP HANA-Host. Die Backups werden jetzt auf Host 2 ausgeführt, und Snapshot-Backups werden auf dem Storage-Volume von Host 2 erstellt.

Das auf Host 2 erstellte Backup kann direkt auf der Speicherebene wiederhergestellt werden. Wenn Sie ein Backup verwenden müssen, das auf Host 1 erstellt wurde, muss das Backup vom Host-1-Speicher-Volume auf das Host-2-Speicher-Volume kopiert werden. Die vorwärts-Wiederherstellung verwendet die Protokoll-Backups von beiden Hosts.

image:anf-cba-image103.png["Diese Abbildung zeigt, wie Forward Recovery die Protokollsicherungen von beiden Hosts verwendet."]



== Backup-Vorgänge mit CBA- und HSR-fähigen HANA-Systemen

Wie im Abschnitt „Prvious“ kurz erläutert, müssen Sie einige Punkte für Backup-Vorgänge mit HSR-fähigen HANA-Systemen in Betracht ziehen.

* Ein Backup-Vorgang kann nur auf dem primären HANA-Host ausgeführt werden. Daher muss CBA bei der Ausführung eines Backup-Vorgangs wissen, welcher Host aktuell der primäre ist.
+
** Die Backup-SQL-Anweisungen müssen für den aktuellen primären Host ausgeführt werden.
** Ein Snapshot-Backup sollte nur auf dem Daten-Volume des primären Hosts erstellt werden, da das Daten-Volume des sekundären Hosts sich nicht in einem konsistenten Zustand befindet und daher für einen Restore- und Recovery-Vorgang nutzlos ist.


* Das Aufbewahrungsmanagement von Snapshot Backups muss über beide Hosts hinweg durchgeführt werden. Wenn beispielsweise ein Failover auf den sekundären Host ausgeführt wurde, müssen die Backups des früheren primären Hosts basierend auf der definierten Aufbewahrung auf allen Ebenen, in CBA, auf dem ANF-Volume und im HANA-Backup-Katalog ebenfalls gelöscht werden. Andernfalls wird das Löschen alter Protokollsicherungen auf Basis der Verwaltung der Protokollsicherung aufgrund alter Datensicherungen blockiert.


In CBA werden beide HANA-Hosts, der primäre und der sekundäre, wie normale HANA-Systeme konfiguriert, wie in der Abbildung unten dargestellt. Der einzige Unterschied während der Konfiguration ist ein Kontrollkästchen, das CBA darüber in Auskunft gibt, dass dieses HANA-System Teil einer HSR-Verandatung ist. CBA liest den HSR-Status von den Hosts und kann herausfinden, welche Hosts zusammengehören und welcher Host primär oder sekundär ist. Bei CBA intern werden diese beiden Hosts als eine Einheit behandelt, wobei ein Backup nur auf dem aktuellen primären Host ausgeführt wird und das Aufbewahrungsmanagement auf beiden Hosts erfolgt.


NOTE: CBA unterstützt HSR nur für eine Konfiguration mit zwei Hosts.

image:anf-cba-image104.png["Diese Abbildung zeigt, wie CBA HSR nur für eine Konfiguration mit zwei Hosts unterstützt."]



== Überblick über die Installations- und Konfigurationsschritte

Es gibt einige kleine Unterschiede in den erforderlichen Konfigurationsschritten für ein HSR-fähiges HANA-System. In diesem Abschnitt heben wir nur die Unterschiede zu den bereits beschriebenen Standardkonfigurationsschritten hervor.

. Erstellen Sie einen Backup-Benutzer in der HANA-Systemdatenbank auf dem primären HSR-Host.
. Fügen Sie den primären Host hinzu und konfigurieren Sie das HANA-System in Cloud Backup für Applikationen.
+
.. Wählen Sie *HANA System Replication* während der Konfiguration aus.
+
image:anf-cba-image105.png["Screenshot des abgeschlossenen Schritts."]

.. Fügen Sie den Storage-Footprint des primären Hosts hinzu.
+
image:anf-cba-image106.png["Screenshot des abgeschlossenen Schritts."]



. Das neue HANA-System ist jetzt mit einem HSR-Symbol aufgelistet.
+
image:anf-cba-image107.png["Screenshot des abgeschlossenen Schritts."]

. Fügen Sie einen sekundären Host hinzu und konfigurieren Sie das HANA-System in Cloud Backup für Applikationen.
+
.. Wählen Sie *HANA System Replication* während der Konfiguration aus.
+
image:anf-cba-image108.png["Screenshot des abgeschlossenen Schritts."]

.. Fügen Sie den Speicherplatzbedarf des sekundären Hosts hinzu.
+
image:anf-cba-image109.png["Screenshot des abgeschlossenen Schritts."]

+
Beide Systeme sind jetzt mit dem HSR-Symbol aufgelistet.

+
image:anf-cba-image110.png["Screenshot des abgeschlossenen Schritts."]



. Fügen Sie Backup-Richtlinien zum primären und sekundären HANA-System hinzu.
+

NOTE: Sie müssen beiden Systemen dieselben Richtlinien hinzufügen, da das Aufbewahrungsmanagement auf beiden HANA-Hosts erfolgt.



Backups werden nun auf Basis der definierten Richtlinien ausgeführt. CBA löst immer den Snapshot-Backup-Vorgang auf dem primären HANA-Host aus.

link:anf-cba-backup-operations-with-hana-multiple-host-systems.html["Weiter: Backup-Vorgänge mit HANA-Systemen mit mehreren Hosts."]
